import{_ as B,b as f,c as b,o as k,a as l,F as M,p as j,u as $,q as _,f as y,t as p,g as U,m as O,v as S}from"./index-B9rNH-u5.js";const q={class:"theme-demo"},D=["onClick"],H={class:"upload-section"},P=["disabled"],V={class:"upload-status"},G={key:0,class:"file-info"},X={key:0},K={class:"download-section"},Z={class:"download-input"},A={class:"download-status"},J={__name:"ColorDemo",setup(Q){const C=_("themes"),R=_("setTheme"),w=f(null),u=f(null),c=f(""),v=f(""),r=f(""),L=()=>{w.value?.click()},x=o=>{const e=o.target.files[0];e&&(u.value=e,c.value=`已选择文件: ${e.name}`)},T=async()=>{if(!u.value){c.value="请先选择文件";return}const o=u.value,e=encodeURIComponent(o.name),n=100*1024*1024,t=Math.ceil(o.size/n);if(t===1){F(o,e);return}try{c.value=`开始分片上传，共 ${t} 个分片...`;for(let s=0;s<t;s++){const a=s*n,h=Math.min(a+n,o.size),i=o.slice(a,h),d=`${e}.part${s+1}`;c.value=`上传分片 ${s+1}/${t}...`,await g(i,d),await new Promise(m=>setTimeout(m,100))}c.value="所有分片上传完成！",u.value=null,w.value.value=""}catch(s){c.value=`分片上传错误: ${s.message}`}},g=(o,e)=>new Promise((n,t)=>{const s=`https://r2.buzhidao.net/${e}`,a=new XMLHttpRequest;a.open("PUT",s,!0),a.setRequestHeader("Content-Type","application/octet-stream"),a.onload=function(){a.status>=200&&a.status<300?n():t(new Error(`分片上传失败: ${a.status} ${a.statusText}`))},a.onerror=function(){t(new Error("网络错误，分片上传失败"))},a.send(o)}),F=(o,e)=>{const n=`https://r2.buzhidao.net/${e}`,t=new XMLHttpRequest;t.open("PUT",n,!0),t.setRequestHeader("Content-Type",o.type),t.onload=function(){t.status>=200&&t.status<300?(c.value="上传成功！",u.value=null,w.value.value=""):c.value=`上传失败: ${t.status} ${t.statusText}`},t.onerror=function(){c.value="网络错误，上传失败"},t.send(o)},I=async()=>{if(!v.value){r.value="请输入要下载的文件名";return}try{r.value="检测分片文件...";const o=encodeURIComponent(v.value);try{const i=`https://r2.buzhidao.net/${o}`,d=await fetch(i,{method:"GET"});if(d.ok){r.value="下载完整文件...",await E(d,v.value);return}}catch{}const e=[];let n=1;for(;;){const i=`${o}.part${n}`,d=`https://r2.buzhidao.net/${encodeURIComponent(i)}`;try{const m=await fetch(d,{method:"GET"});if(!m.ok)break;m.blob().then(N=>URL.revokeObjectURL(URL.createObjectURL(N))),e.push(n),n++}catch{break}}if(e.length===0){r.value="未找到文件或分片";return}r.value=`找到 ${e.length} 个分片，开始下载...`;const t=[];for(const i of e){r.value=`下载分片 ${i}/${e.length}...`;const d=await z(o,i);t.push(d)}r.value="合并分片...";const s=new Blob(t),a=URL.createObjectURL(s),h=document.createElement("a");h.href=a,h.download=v.value,document.body.appendChild(h),h.click(),document.body.removeChild(h),URL.revokeObjectURL(a),r.value="下载完成！"}catch(o){r.value=`下载错误: ${o.message}`}},z=async(o,e)=>{const n=`${o}.part${e}`,t=`https://r2.buzhidao.net/${encodeURIComponent(n)}`,s=await fetch(t);if(!s.ok)throw new Error(`下载分片 ${e} 失败: ${s.status}`);return await s.blob()},E=async(o,e)=>{if(!o.ok)throw new Error(`下载文件失败: ${o.status}`);const n=await o.blob(),t=URL.createObjectURL(n),s=document.createElement("a");s.href=t,s.download=e,document.body.appendChild(s),s.click(),document.body.removeChild(s),URL.revokeObjectURL(t)};return(o,e)=>(k(),b("div",q,[e[4]||(e[4]=l("h2",null,"UI 颜色调色板",-1)),(k(!0),b(M,null,j($(C),n=>(k(),b("button",{key:n,onClick:t=>$(R)(n)},p(n),9,D))),128)),l("div",H,[e[2]||(e[2]=l("h3",null,"文件上传",-1)),l("input",{ref_key:"fileInput",ref:w,type:"file",style:{display:"none"},onChange:x},null,544),l("button",{onClick:L,class:"upload-btn"},"选择文件"),l("button",{onClick:T,class:"upload-btn",disabled:!u.value}," 上传文件 ",8,P),l("div",V,p(c.value),1),u.value?(k(),b("div",G,[U(" 文件名: "+p(u.value.name),1),e[1]||(e[1]=l("br",null,null,-1)),U(" 大小: "+p((u.value.size/1024/1024).toFixed(2))+" MB ",1),Math.ceil(u.value.size/(300*1024*1024))>1?(k(),b("div",X," (将分成 "+p(Math.ceil(u.value.size/(300*1024*1024)))+" 个分片上传) ",1)):y("",!0)])):y("",!0)]),l("div",K,[e[3]||(e[3]=l("h3",null,"文件下载",-1)),l("div",Z,[O(l("input",{"onUpdate:modelValue":e[0]||(e[0]=n=>v.value=n),type:"text",placeholder:"输入要下载的文件名",class:"download-input-field"},null,512),[[S,v.value]]),l("button",{onClick:I,class:"download-btn"},"下载文件")]),l("div",A,p(r.value),1)])]))}},Y=B(J,[["__scopeId","data-v-fef21eed"]]);export{Y as default};
