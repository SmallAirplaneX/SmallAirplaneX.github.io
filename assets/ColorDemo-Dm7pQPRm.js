import{_ as B,b as f,c as b,o as k,a as l,F as M,p as S,u as $,q as _,f as y,t as p,g as U,m as j,v as H}from"./index-DHTD-_7W.js";const O={class:"theme-demo"},q=["onClick"],D={class:"upload-section"},P=["disabled"],V={class:"upload-status"},G={key:0,class:"file-info"},K={key:0},X={class:"download-section"},Z={class:"download-input"},A={class:"download-status"},J={__name:"ColorDemo",setup(Q){const C=_("themes"),R=_("setTheme"),w=f(null),u=f(null),c=f(""),v=f(""),r=f(""),L=()=>{w.value?.click()},N=t=>{const e=t.target.files[0];e&&(u.value=e,c.value=`已选择文件: ${e.name}`)},T=async()=>{if(!u.value){c.value="请先选择文件";return}const t=u.value,e=encodeURIComponent(t.name),s=100*1024*1024,o=Math.ceil(t.size/s);if(o===1){x(t,e);return}try{c.value=`开始分片上传，共 ${o} 个分片...`;for(let n=0;n<o;n++){const a=n*s,h=Math.min(a+s,t.size),i=t.slice(a,h),d=`${e}.part${n+1}`;c.value=`上传分片 ${n+1}/${o}...`,await g(i,d),await new Promise(m=>setTimeout(m,100))}c.value="所有分片上传完成！",u.value=null,w.value.value=""}catch(n){c.value=`分片上传错误: ${n.message}`}},g=(t,e)=>new Promise((s,o)=>{const n=`https://r2.buzhidao.net/${e}`,a=new XMLHttpRequest;a.open("PUT",n,!0),a.setRequestHeader("Content-Type","application/octet-stream"),a.onload=function(){a.status>=200&&a.status<300?s():o(new Error(`分片上传失败: ${a.status} ${a.statusText}`))},a.onerror=function(){o(new Error("网络错误，分片上传失败"))},a.send(t)}),x=(t,e)=>{const s=`https://r2.buzhidao.net/${e}`,o=new XMLHttpRequest;o.open("PUT",s,!0),o.setRequestHeader("Content-Type",t.type),o.onload=function(){o.status>=200&&o.status<300?(c.value="上传成功！",u.value=null,w.value.value=""):c.value=`上传失败: ${o.status} ${o.statusText}`},o.onerror=function(){c.value="网络错误，上传失败"},o.send(t)},F=async()=>{if(!v.value){r.value="请输入要下载的文件名";return}try{r.value="检测分片文件...";const t=encodeURIComponent(v.value);try{const i=`https://r2.buzhidao.net/${t}`,d=await fetch(i,{method:"GET"});if(d.ok){r.value="下载完整文件...",await z(d,v.value);return}}catch{}const e=[];let s=1;for(;;){const d=`https://r2.buzhidao.net/${`${t}.part${s}`}`;try{const m=await fetch(d,{method:"GET"});if(!m.ok)break;m.blob().then(I=>URL.revokeObjectURL(URL.createObjectURL(I))),e.push(s),s++}catch{break}}if(e.length===0){r.value="未找到文件或分片";return}r.value=`找到 ${e.length} 个分片，开始下载...`;const o=[];for(const i of e){r.value=`下载分片 ${i}/${e.length}...`;const d=await E(t,i);o.push(d)}r.value="合并分片...";const n=new Blob(o),a=URL.createObjectURL(n),h=document.createElement("a");h.href=a,h.download=v.value,document.body.appendChild(h),h.click(),document.body.removeChild(h),URL.revokeObjectURL(a),r.value="下载完成！"}catch(t){r.value=`下载错误: ${t.message}`}},E=async(t,e)=>{const o=`https://r2.buzhidao.net/${`${t}.part${e}`}`,n=await fetch(o);if(!n.ok)throw new Error(`下载分片 ${e} 失败: ${n.status}`);return await n.blob()},z=async(t,e)=>{if(!t.ok)throw new Error(`下载文件失败: ${t.status}`);const s=await t.blob(),o=URL.createObjectURL(s),n=document.createElement("a");n.href=o,n.download=e,document.body.appendChild(n),n.click(),document.body.removeChild(n),URL.revokeObjectURL(o)};return(t,e)=>(k(),b("div",O,[e[4]||(e[4]=l("h2",null,"UI 颜色调色板",-1)),(k(!0),b(M,null,S($(C),s=>(k(),b("button",{key:s,onClick:o=>$(R)(s)},p(s),9,q))),128)),l("div",D,[e[2]||(e[2]=l("h3",null,"文件上传",-1)),l("input",{ref_key:"fileInput",ref:w,type:"file",style:{display:"none"},onChange:N},null,544),l("button",{onClick:L,class:"upload-btn"},"选择文件"),l("button",{onClick:T,class:"upload-btn",disabled:!u.value}," 上传文件 ",8,P),l("div",V,p(c.value),1),u.value?(k(),b("div",G,[U(" 文件名: "+p(u.value.name),1),e[1]||(e[1]=l("br",null,null,-1)),U(" 大小: "+p((u.value.size/1024/1024).toFixed(2))+" MB ",1),Math.ceil(u.value.size/(300*1024*1024))>1?(k(),b("div",K," (将分成 "+p(Math.ceil(u.value.size/t.CHUNK_SIZE))+" 个分片上传) ",1)):y("",!0)])):y("",!0)]),l("div",X,[e[3]||(e[3]=l("h3",null,"文件下载",-1)),l("div",Z,[j(l("input",{"onUpdate:modelValue":e[0]||(e[0]=s=>v.value=s),type:"text",placeholder:"输入要下载的文件名",class:"download-input-field"},null,512),[[H,v.value]]),l("button",{onClick:F,class:"download-btn"},"下载文件")]),l("div",A,p(r.value),1)])]))}},Y=B(J,[["__scopeId","data-v-89c84b3d"]]);export{Y as default};
